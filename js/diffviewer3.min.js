(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("codemirror"))}else{if(typeof define=="function"&&define.amd){define(["codemirror","diff_match_patch"],a)}else{a(CodeMirror)}}})(function(n){var ao=n.Pos;var h="http://www.w3.org/2000/svg";var l={del:"DTS-deleted",ins:"DTS-inserted",rel:"DTS-relabeled",mov:"DTS-moved",movrel:"DTS-moved-and-relabeled",ign:"DTS-ignored",mis:"DTS-missed",frame:"DTS-frame",frameEss:"DTS-frame-essential",cmov:"DTS-connector-move",crel:"DTS-connector-relabel",cmovrel:"DTS-connector-movrel",calign:"DTS-connector-align",ccorr:"DTS-connector-corr",ess:"DTS-essential-lines",essStart:"DTS-essential-lines-start",essEnd:"DTS-essential-lines-end"};function ac(aG,aI,aH){this.mv=aG;this.type=aI;this.index=aH;this.classes=aI=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}ac.prototype={constructor:ac,init:function(aL,aK,aJ,aH){this.edit=this.mv.edit;(this.edit.state.diffViews||(this.edit.state.diffViews=[])).push(this);this.diffDtsEss=this.mv.diffDtsEss;var aI=!this.mv.options.allowEditingOriginals;this.orig=n(aL,ai({value:aK,readOnly:aI},ai(aH)));if(this.mv.options.connect=="align"){if(!this.edit.state.trackAlignable){this.edit.state.trackAlignable=new b(this.edit)}this.orig.state.trackAlignable=new b(this.orig)}this.lockButton.title=this.edit.phrase("Toggle locked scrolling");this.orig.state.diffViews=[this];var aG=aH.chunkClassLocation||"background";if(Object.prototype.toString.call(aG)!="[object Array]"){aG=[aG]}this.classes.classLocation=aG;this.showDifferences=aH.showDifferences!==false;this.showDts=aH.showDts;if(this.showDifferences){this.deferredDiffFlag=false;this.diff=aB(o(aK),o(aH.value),this.mv.options.ignoreWhitespace);this.chunks=r(this.diff)}else{this.deferredDiffFlag=true;this.diff=[];this.chunks=[]}this.diffOutOfDate=this.dealigned=false;this.needsScrollSync=null;this.diffDts=aJ;this.showToolTip=true;this.toolTipTimer=null;this.orig.dv=this;this.edit.dv=this;this.orig.on("mousedown",d)},registerEvents:function(aG){this.forceUpdate=e(this);S(this,false,false);E(this,aG)},setShowDifferences:function(aG){aG=aG!==false;if(aG!=this.showDifferences){if(this.deferredDiffFlag){this.diff=aB(this.orig.getValue(),this.edit.getValue(),this.mv.options.ignoreWhitespace);this.chunks=r(this.diff);this.deferredDiffFlag=false}this.showDifferences=aG;this.forceUpdate("full")}},setShowDts:function(aG){if(aG!=this.showDts){this.showDts=aG;if(this.index==1||aG!=1){this.forceUpdate("full");if(this.dtsAnnot){this.dtsAnnot.clear()}if(this.dtsAnnotEss){this.dtsAnnotEss.clear()}this.dtsAnnot=null;this.dtsAnnotEss=null}}},setShowToolTip:function(aH,aG){aH=aH!==false;if(!aH){if(this.toolTipTimer){clearTimeout(this.toolTipTimer)}if(!aG){aG=1000}this.toolTipTimer=setTimeout(aF,aG,this)}if(aH!=this.showToolTip){this.showToolTip=aH;if(aH){this.forceUpdate("full");this.toolTipTimer=null}}}};function aq(aG){if(aG.diffOutOfDate){aG.diff=aB(aG.orig.getValue(),aG.edit.getValue(),aG.mv.options.ignoreWhitespace);aG.chunks=r(aG.diff);aG.diffOutOfDate=false;n.signal(aG.edit,"updateDiff",aG.diff)}}var y=false;function e(aH){var aS={from:0,to:0,marked:[]};var aR={from:0,to:0,marked:[]};var aL={from:0,to:0,marked:[]};var aM={from:0,to:0,marked:[]};var aK={from:0,to:0,marked:[],tbl:{}};var aN={from:0,to:0,marked:[],tbl:{}};var aG,aT=false;function aJ(aU){y=true;aT=false;if(aU=="full"){if(aH.svg){Z(aH.svg)}if(aH.mv.svg){Z(aH.mv.svg)}if(aH.copyButtons){Z(aH.copyButtons)}g(aH.edit,aS.marked,aH.classes);g(aH.orig,aR.marked,aH.classes);aS.from=aS.to=aR.from=aR.to=0;j(aH.edit,aL.marked);j(aH.orig,aM.marked);aL.from=aL.to=aM.from=aM.to=0}aq(aH);if(aH.showDifferences){p(aH.edit,aH.diff,aS,DIFF_INSERT,aH.classes);p(aH.orig,aH.diff,aR,DIFF_DELETE,aH.classes)}if((aH.showDts&aH.index)>0){v(1,aH.edit,aH.diffDts,aL);v(2,aH.orig,aH.diffDts,aM)}if(aH.mv.options.connect=="align"){V(aH)}z(aH);if(aH.needsScrollSync!=null){aA(aH,aH.needsScrollSync)}y=false}function aO(aU){if(y){return}aH.dealigned=true;aQ(aU)}function aQ(aU){if(y||aT){return}clearTimeout(aG);if(aU===true){aT=true}aG=setTimeout(aJ,aU===true?20:250)}function aP(aU,aV){if(!aH.diffOutOfDate){aH.diffOutOfDate=true;aS.from=aS.to=aR.from=aR.to=0}aO(aV.text.length-1!=aV.to.line-aV.from.line)}function aI(){aH.diffOutOfDate=true;aH.dealigned=true;aJ("full")}aH.edit.on("change",aP);aH.orig.on("change",aP);aH.edit.on("swapDoc",aI);aH.orig.on("swapDoc",aI);if(aH.mv.options.connect=="align"){n.on(aH.edit.state.trackAlignable,"realign",aO);n.on(aH.orig.state.trackAlignable,"realign",aO)}aH.edit.on("viewportChange",function(){aQ(false)});aH.orig.on("viewportChange",function(){aQ(false)});aH.edit.on("keyHandled",function(){aQ(false)});aH.orig.on("keyHandled",function(){aQ(false)});aH.edit.onSearchClose=function(){aQ(false)};aH.orig.onSearchClose=function(){aQ(false)};aJ();return aJ}function E(aG,aH){aG.edit.on("scroll",function(){aA(aG,true)&&z(aG)});aG.orig.on("scroll",function(){aA(aG,false)&&z(aG);if(aH){aA(aH,true)&&z(aH)}})}function aA(aS,aJ){if(aS.diffOutOfDate){if(aS.lockScroll&&aS.needsScrollSync==null){aS.needsScrollSync=aJ}return false}aS.needsScrollSync=null;if(!aS.lockScroll){return true}var aL,aN,aI=+new Date;if(aJ){aL=aS.edit;aN=aS.orig}else{aL=aS.orig;aN=aS.edit}if(aL.state.scrollSetBy==aS&&(aL.state.scrollSetAt||0)+250>aI){return false}var aG=aL.getScrollInfo();if(aS.mv.options.connect=="align"){aK=aG.top}else{var aH=0.5*aG.clientHeight,aQ=aG.top+aH;var aW=aL.lineAtHeight(aQ,"local");var aU;if(aS.showDifferences){aU=k(aS.chunks,aW,aJ)}else{aU=T(aS.diffDts,aW,aJ)}var aX=aE(aL,aJ?aU.edit:aU.orig);var aP=aE(aN,aJ?aU.orig:aU.edit);var aO=(aQ-aX.top)/(aX.bot-aX.top);var aK=(aP.top-aH)+aO*(aP.bot-aP.top);var aM,aR;if(aK>aG.top&&(aR=aG.top/aH)<1){aK=aK*aR+aG.top*(1-aR)}else{if((aM=aG.height-aG.clientHeight-aG.top)<aH){var aV=aN.getScrollInfo();var aT=aV.height-aV.clientHeight-aK;if(aT>aM&&(aR=aM/aH)<1){aK=aK*aR+(aV.height-aV.clientHeight-aM)*(1-aR)}}}}aN.scrollTo(aG.left,aK);aN.state.scrollSetAt=aI;aN.state.scrollSetBy=aS;return true}function aE(aG,aH){var aI=aH.after;if(aI==null){aI=aG.lastLine()+1}return{top:aG.heightAtLine(aH.before||0,"local"),bot:aG.heightAtLine(aI,"local")}}function S(aG,aI,aH){aG.lockScroll=aI;if(aI&&aH!=false){aA(aG,DIFF_INSERT)&&z(aG)}(aI?n.addClass:n.rmClass)(aG.lockButton,"CodeMirror-merge-scrolllock-enabled")}function ay(aJ,aG,aI){var aK=aI.classLocation;for(var aH=0;aH<aK.length;aH++){aJ.removeLineClass(aG,aK[aH],aI.chunk);aJ.removeLineClass(aG,aK[aH],aI.start);aJ.removeLineClass(aG,aK[aH],aI.end)}}function g(aJ,aG,aI){for(var aH=0;aH<aG.length;++aH){var aK=aG[aH];if(aK instanceof n.TextMarker){aK.clear()}else{if(aK.parent){ay(aJ,aK,aI)}}}aG.length=0}function p(aJ,aL,aK,aI,aH){var aG=aJ.getViewport();aJ.operation(function(){if(aK.from==aK.to||aG.from-aK.to>20||aK.from-aG.to>20){g(aJ,aK.marked,aH);B(aJ,aL,aI,aK.marked,aG.from,aG.to,aH);aK.from=aG.from;aK.to=aG.to}else{if(aG.from<aK.from){B(aJ,aL,aI,aK.marked,aG.from,aK.from,aH);aK.from=aG.from}if(aG.to>aK.to){B(aJ,aL,aI,aK.marked,aK.to,aG.to,aH);aK.to=aG.to}}})}function at(aN,aH,aI,aK,aG,aJ){var aM=aI.classLocation,aO=aN.getLineHandle(aH);for(var aL=0;aL<aM.length;aL++){if(aK){aN.addLineClass(aO,aM[aL],aI.chunk)}if(aG){aN.addLineClass(aO,aM[aL],aI.start)}if(aJ){aN.addLineClass(aO,aM[aL],aI.end)}}return aO}function B(aN,aR,aM,aX,aW,aI,aZ){var aP=ao(0,0);var aT=ao(aW,0),aS=aN.clipPos(ao(aI-1));var aG=aM==DIFF_DELETE?aZ.del:aZ.insert;function aQ(a7,a3){var a6=Math.max(aW,a7),a4=Math.min(aI,a3);for(var a5=a6;a5<a4;++a5){aX.push(at(aN,a5,aZ,true,a5==a7,a5==a3-1))}if(a7==a3&&a6==a3&&a4==a3){if(a6){aX.push(at(aN,a6-1,aZ,false,false,true))}else{aX.push(at(aN,a6,aZ,false,true,false))}}}var a2=0,aO=false;for(var aY=0;aY<aR.length;++aY){var aV=aR[aY],aH=aV[0],aU=aV[1];if(aH==DIFF_EQUAL){var aL=aP.line+(F(aR,aY)?0:1);an(aP,aU);var aK=aP.line+(q(aR,aY)?1:0);if(aK>aL){if(aO){aQ(a2,aL);aO=false}a2=aK}}else{aO=true;if(aH==aM){var aJ=an(aP,aU,true);var a1=aj(aT,aP),a0=O(aS,aJ);if(!C(a1,a0)){aX.push(aN.markText(a1,a0,{className:aG}))}aP=aJ}}}if(aO){aQ(a2,aP.line+1)}}function j(aI,aG){for(var aH=0;aH<aG.length;++aH){var aJ=aG[aH];if(aJ instanceof n.TextMarker){aJ.clear()}}aG.length=0}function v(aH,aG,aK,aJ){var aI=aG.getViewport();aG.operation(function(){if(aJ.from==aJ.to||aI.from-aJ.to>20||aJ.from-aI.to>20){j(aG,aJ.marked);W(aH,aG,aK,aJ.marked,aI.from,aI.to);aJ.from=aI.from;aJ.to=aI.to}else{if(aI.from<aJ.from){W(aH,aG,aK,aJ.marked,Math.max(aI.from-10,0),aJ.from);aJ.from=aI.from}if(aI.to>aJ.to){W(aH,aG,aK,aJ.marked,aJ.to,aI.to+10);aJ.to=aI.to}}})}function J(aP,aL,aN,aO){if(aN==0){return 0}var aI=0;var aH=aL.length;var aK,aQ,aM,aG;var aJ=0;while(aH-aI>2){aJ+=1;if(aJ>100){return 0}aG=Math.floor((aI+aH)/2);aK=aL[aG];if(aK==undefined){return 0}aQ=aK["line"+aP];aM=aK["line"+aP+"_"];if(aM<aN){aI=aG}else{if(aQ>aO){aH=aG}else{while(aG>0&&aL[aG-1]["line"+aP+"_"]>=aN){aJ+=1;aG-=1}aI=aG;break}}}return aI}function W(aU,aQ,a2,a6,a4,aJ){var aO;if(aU==1){aO=a2.edits1}else{if(aU==2){aO=a2.edits2}}if(aO==undefined){return null}var be=aQ.getDoc();var aV=new ao(a4,0),aT=aQ.clipPos(new ao(aJ-1,0));var aR,bd,a1,aX,aH,bb,aP;var ba,a0,aM,aK,aS,a9,aW,aG,aI;var a7,a5,a3;var aZ,aY,bc,a8=false;var aN=0;var aL=J(aU,aO,a4,aJ);for(a7=aL;a7<aO.length;++a7){aN+=1;aR=aO[a7];if(aR==null){continue}bd=aR.tag;a1="segments"+aU;aX=aR[a1];if(aX==undefined){continue}aH=null;bb="IGNORED"+aU;aP="MISPARSED"+aU;switch(bd){case"DELETE":aH=l.del;break;case"INSERT":aH=l.ins;break;case"RELABEL":aH=l.rel;break;case"MOVREL":aH=l.movrel;break;case"MOVE":aH=l.mov;break;case bb:aH=l.ign;break;case aP:aH=l.miss;break}if(aH==null){continue}aG=be.posFromIndex(aR["start"+aU]).line;aI=be.posFromIndex(aR["end"+aU]).line;for(a5=0;a5<aX.length;a5++){ba=aX[a5];a0=ba.start;aM=ba.end+1;aK=be.posFromIndex(a0);aS=be.posFromIndex(aM);a9=aK.line;aW=aS.line;bc=false;aY=be.findMarks(aK,aS);for(a3=0;a3<aY.length;a3++){if(aY[a3].className==aH){if(aY[a3].editDts===aR){bc=true;break}}}if(!bc){aZ=be.markText(aK,aS,{className:aH,startStyle:aH+"-left",endStyle:aH+"-right",atomic:false});aZ.editDts=aR;a6.push(aZ)}if(aW<a4||aJ<a9){if(aG>aJ){a8=true}}}if(a8){break}}return aN}function z(aH){if((aH.showDts&aH.index)>0){al(aH,aH.diffDts,false)}else{al(aH,aH.mv.diffDtsEss,true)}if(!aH.showDifferences){return}if(aH.svg){Z(aH.svg);var aO=aH.gap.offsetWidth;a(aH.svg,"width",aO,"height",aH.gap.offsetHeight)}if(aH.copyButtons){Z(aH.copyButtons)}var aM=aH.edit.getViewport(),aN=aH.orig.getViewport();var aL=aH.mv.wrap.getBoundingClientRect().top;var aJ=aL-aH.edit.getScrollerElement().getBoundingClientRect().top+aH.edit.getScrollInfo().top;var aI=aL-aH.orig.getScrollerElement().getBoundingClientRect().top+aH.orig.getScrollInfo().top;for(var aK=0;aK<aH.chunks.length;aK++){var aG=aH.chunks[aK];if(aG.editFrom<=aM.to&&aG.editTo>=aM.from&&aG.origFrom<=aN.to&&aG.origTo>=aN.from){N(aH,aG,aI,aJ,aO)}}}function L(aL,aK){var aJ=0,aI=0;for(var aH=0;aH<aK.length;aH++){var aG=aK[aH];if(aG.editTo>aL&&aG.editFrom<=aL){return null}if(aG.editFrom>aL){break}aJ=aG.editTo;aI=aG.origTo}return aI+(aL-aJ)}function M(aP,aM,aJ){var aO=aP.state.trackAlignable;var aH=aP.firstLine(),aL=0;var aQ=[];for(var aK=0;;aK++){var aN=aM[aK];var aG=!aN?1000000000:aJ?aN.origFrom:aN.editFrom;for(;aL<aO.alignable.length;aL+=2){var aI=aO.alignable[aL]+1;if(aI<=aH){continue}if(aI<=aG){aQ.push(aI)}else{break}}if(!aN){break}aQ.push(aH=aJ?aN.origTo:aN.editTo)}return aQ}function af(aT,aQ,aO,aG){var aH=0,aM=0,aJ=0,aS=0;outer:for(;;aH++){var aI=aT[aH],aK=aQ[aM];if(!aI&&aK==null){break}var aL=aI?aI[0]:1000000000,aP=aK==null?1000000000:aK;while(aJ<aO.length){var aR=aO[aJ];if(aR.origFrom<=aP&&aR.origTo>aP){aM++;aH--;continue outer}if(aR.editTo>aL){if(aR.editFrom<=aL){continue outer}break}aS+=(aR.origTo-aR.origFrom)-(aR.editTo-aR.editFrom);aJ++}if(aL==aP-aS){aI[aG]=aP;aM++}else{if(aL<aP-aS){aI[aG]=aL+aS}else{var aN=[aP-aS,null,null];aN[aG]=aP;aT.splice(aH,0,aN);aM++}}}}function K(aL,aH){var aJ=M(aL.edit,aL.chunks,false),aG=[];if(aH){for(var aK=0,aI=0;aK<aH.chunks.length;aK++){var aM=aH.chunks[aK].editTo;while(aI<aJ.length&&aJ[aI]<aM){aI++}if(aI==aJ.length||aJ[aI]!=aM){aJ.splice(aI++,0,aM)}}}for(var aK=0;aK<aJ.length;aK++){aG.push([aJ[aK],null,null])}af(aG,M(aL.orig,aL.chunks,true),aL.chunks,1);if(aH){af(aG,M(aH.orig,aH.chunks,true),aH.chunks,2)}return aG}function V(aG,aH){if(!aG.dealigned&&!aH){return}if(!aG.orig.curOp){return aG.orig.operation(function(){V(aG,aH)})}aG.dealigned=false;var aK=aG.mv.left==aG?aG.mv.right:aG.mv.left;if(aK){aq(aK);aK.dealigned=false}var aJ=K(aG,aK);var aO=aG.mv.aligners;for(var aI=0;aI<aO.length;aI++){aO[aI].clear()}aO.length=0;var aN=[aG.edit,aG.orig],aM=[];if(aK){aN.push(aK.orig)}for(var aI=0;aI<aN.length;aI++){aM.push(aN[aI].getScrollInfo().top)}for(var aL=0;aL<aJ.length;aL++){aa(aN,aJ[aL],aO)}for(var aI=0;aI<aN.length;aI++){aN[aI].scrollTo(null,aM[aI])}}function aa(aG,aH,aK){var aJ=0,aN=[];for(var aI=0;aI<aG.length;aI++){if(aH[aI]!=null){var aM=aG[aI].heightAtLine(aH[aI],"local");aN[aI]=aM;aJ=Math.max(aJ,aM)}}for(var aI=0;aI<aG.length;aI++){if(aH[aI]!=null){var aL=aJ-aN[aI];if(aL>1){aK.push(ae(aG[aI],aH[aI],aL))}}}}function ae(aH,aI,aK){var aG=true;if(aI>aH.lastLine()){aI--;aG=false}var aJ=document.createElement("div");aJ.className="CodeMirror-merge-spacer";aJ.style.height=aK+"px";aJ.style.minWidth="1px";return aH.addLineWidget(aI,aJ,{height:aK,above:aG,mergeSpacer:true,handleMouseEvents:true})}function ah(aN,aG,aL,aK){var aR=aG.left;var aQ=aG.top;var a0=aN.getDoc();var aI=aN.charCoords(aL,"page");var aH=aN.charCoords(aK,"page");var aU=aI.left-aR,aT=aI.top-aQ;var aY=aU;var aS;var aM=aU+" "+aT;if(aL.ch==0||aL.line==aK.line){aS="L "+aM+" "}else{var aZ=aN.charCoords(new ao(aL.line,0),"page");aY=aZ.left-aR;aS="L "+aY+" "+(aZ.bottom-aQ)+" L "+aU+" "+(aI.bottom-aQ)+" L "+aM+" "}var aW="M "+aM+" ";for(var aO=aL.line;aO<aK.line+1;aO++){var aP=a0.getLine(aO);if(aO==aK.line){var aX=aH.right-aR;var aJ=aH.bottom-aQ;aW+="L "+aX+" "+(aH.top-aQ)+" L "+aX+" "+aJ+" ";aW+="L "+aY+" "+aJ+" "+aS}else{var aV=aN.charCoords(new ao(aO,aP.length-1),"page");var aX=aV.right-aR;var aJ=aV.bottom-aQ;aW+="L "+aX+" "+(aV.top-aQ)+" L "+aX+" "+aJ+" "}}return aW}function G(aL,aG,aR,aN,aW,aI){if(aW==undefined){aW=aG.appendChild(document.createElementNS(h,"clipPath"))}a(aW,"id",aR);var aV=aN.getWrapperElement();var aH=aV.getBoundingClientRect();var aM=0;var aY=aV.getElementsByClassName("CodeMirror-dialog");for(var aU=0;aU<aY.length;aU++){var aQ=aY[aU].getBoundingClientRect();if(aQ){aM=aQ.height;break}}var aX=0;var aP=aH.left;var aS=aH.width;var aT=aN.display.gutters;if(aT){var aZ=aT.getBoundingClientRect();aX=aZ.width;aP=aZ.right+1;aS-=aX}var aK=0;var a0=aV.getElementsByClassName("CodeMirror-simplescroll-vertical");for(var aU=0;aU<a0.length;aU++){var aQ=a0[aU].getBoundingClientRect();if(aQ){aK=aQ.width;break}}aS-=aK;var aJ=0;var aO=aV.getElementsByClassName("CodeMirror-simplescroll-horizontal");for(var aU=0;aU<aO.length;aU++){var aQ=aO[aU].getBoundingClientRect();if(aQ){aJ=aQ.height;break}}var aQ={x:aP-aL.left,y:aH.top-aL.top+aM,height:aH.height-aM-aJ,width:aS};if(aI==undefined){aI=aW.appendChild(document.createElementNS(h,"rect"))}a(aI,"x",aQ.x,"y",aQ.y,"height",aQ.height,"width",aQ.width);return[aP,aQ,aM>0,aX]}function ab(aM,aL,aO,aN,aK,aJ,aH){var aI=document.createElementNS(h,"clipPath");a(aJ.appendChild(aI),"id",aH);var aG="M "+aO.x+" "+aO.y+" v "+aO.height+" L "+(aN.x+aN.width)+" "+(aN.y+aN.height)+" v "+(-aN.height);if(aM&&!aL){aG+=" L "+(aO.x+aO.width)+" "+(aN.y)+" v "+(aN.height-aO.height)}else{if(!aM&&aL){aG+=" h "+(-aN.width-aK-1)+" v "+(aN.height-aO.height)}}aG+=" z";a(aI.appendChild(document.createElementNS(h,"path")),"d",aG)}function P(aJ,aH,aL){if(!aL){return}if(aJ.annotateScrollbar&&aH.annotateScrollbar){this.annotationL=aJ.annotateScrollbar("DTS-scrollbar-marks");this.annotationR=aH.annotateScrollbar("DTS-scrollbar-marks");this.marksL=[];this.marksR=[];var aK=aJ.getDoc();var aG=aH.getDoc();for(var aM=0;aM<aL.length;++aM){var aQ=aL[aM];if(aQ==null){continue}var aR=aQ.tag;switch(aR){case"DELETE":var aI={from:aK.posFromIndex(aQ.start1),to:aK.posFromIndex(aQ.end1+1)};this.marksL.push(aI);break;case"INSERT":var aI={from:aG.posFromIndex(aQ.start2),to:aG.posFromIndex(aQ.end2+1)};this.marksR.push(aI);break;case"RELABEL":case"MOVREL":case"MOVE":var aP={from:aK.posFromIndex(aQ.start1),to:aK.posFromIndex(aQ.end1+1)};var aN={from:aG.posFromIndex(aQ.start2),to:aG.posFromIndex(aQ.end2+1)};this.marksL.push(aP);this.marksR.push(aN);break;default:break}}var aO=function(aT,aS){return aT.from.line-aS.from.line};this.marksL.sort(aO);this.marksR.sort(aO)}}P.prototype.mark=function(){if(this.annotationL&&this.annotationR){try{this.annotationL.update(this.marksL);this.annotationR.update(this.marksR)}catch(aG){console.log("caught exception: "+aG)}}};P.prototype.clear=function(){try{if(this.annotationL){this.annotationL.clear()}}catch(aG){console.log("annotationL: caught exception: "+aG)}try{if(this.annotationR){this.annotationR.clear()}}catch(aG){console.log("annotationR: caught exception: "+aG)}};function A(aJ){var aI=aJ[0];var aH=aJ[1];var aG;if(typeof aH=="string"){aG=aH;aH=aI}else{aG=aJ[2]}return[aI,aH,aG]}function Y(aK,aH,aJ){var aN=[];for(var aL=0;aL<aK.length;aL++){var aM=A(aK[aL]);aN.push({tag:"DELETE",start1:aM[0],end1:aM[1],v1:aM[2]})}for(var aL=0;aL<aH.length;aL++){var aM=A(aH[aL]);aN.push({tag:"INSERT",start2:aM[0],end2:aM[1],v2:aM[2]})}for(var aL=0;aL<aJ.length;aL++){var aI=A(aJ[aL][0]);var aG=A(aJ[aL][1]);aN.push({tag:"CORR",start1:aI[0],end1:aI[1],start2:aG[0],end2:aG[1],v1:aI[2],v2:aG[2]})}return aN}function c(aH,aG){aH.setShowToolTip(false,aG)}function aF(aG){aG.setShowToolTip(true)}function ax(aH,aK,aI,aG){this.svg=aH;this.frame=aK;this.dv=aI;var aJ=this.bound=aI.mv.glasspane.getBoundingClientRect();this.v=aG;this.textElem=document.createElementNS(h,"text");this.textElem.textContent=this.v;this.rectElem=document.createElementNS(h,"rect");this.show=function(){var aO=this.frame.getBoundingClientRect();var aL=aO.left+aO.width/2;var aN=aJ.top<aO.top?aO.top-aJ.top:0;var aM=aO.bottom<aJ.bottom?aO.bottom-aJ.top:aJ.height;var aR=(aN+aM)/2;this.svg.appendChild(this.rectElem);this.svg.appendChild(this.textElem);a(this.textElem,"x",aL,"y",aR);var aQ=this.textElem.getBBox();var aP=10;a(this.rectElem,"x",aL-aP,"y",aR-aQ.height-aP,"height",aQ.height+2*aP,"width",aQ.width+2*aP,"class","DTS-tooltip")};this.hide=function(){try{this.svg.removeChild(this.textElem);this.svg.removeChild(this.rectElem)}catch(aL){}}}function ag(aJ){var aK=aJ;while(aK){var aL=Object.keys(aK);for(var aI=0;aI<aL.length;aI++){var aH=aL[aI];var aG=aJ[aH];if(typeof aG!="function"){console.log("  "+aH+"="+aG)}}aK=Object.getPrototypeOf(aK)}}function aD(aH){var aG=document.createEvent("MouseEvents");aG.initMouseEvent(aH.type,aH.bubbles,aH.cancelable,aH.view,aH.detail,aH.screenX,aH.screenY,aH.clientX,aH.clientY,aH.ctrlKey,aH.altKey,aH.shiftKey,aH.metaKey,aH.button,aH.relatedTarget);return aG}function aw(aH){var aG=document.createEvent("MouseScrollEvents");aG.initMouseEvent(aH.type,aH.bubbles,aH.cancelable,aH.view,aH.detail,aH.screenX,aH.screenY,aH.clientX,aH.clientY,aH.ctrlKey,aH.altKey,aH.shiftKey,aH.metaKey,aH.button,aH.relatedTarget,aH.axis);return aG}function s(aG){return function(aH){aG.show()}}function az(aG){return function(aH){aG.hide()}}function ar(aH,aG){return function(aJ){if(aJ instanceof WheelEvent){var aI=new WheelEvent(aJ.type,{deltaX:aJ.deltaX,deltaY:aJ.deltaY,deltaZ:aJ.deltaZ,deltaMode:aJ.deltaMode});aG.getScrollerElement().dispatchEvent(aI)}}}function I(aH){var aG=aH.dv;var aI=aH.frame;return function(aL){if(aL instanceof MouseScrollEvent){c(aG,1000);var aJ=aw(aL);a(aI,"display","none");var aK=document.elementFromPoint(aL.pageX,aL.pageY);a(aI,"display","inline")}}}function w(aG){return function(aI){if(aI instanceof MouseEvent){var aH=aD(aI);aG.getScrollerElement().dispatchEvent(aH)}}}function d(aG,aL){var aM=aG.coordsChar({left:aL.pageX,top:aL.pageY},"page");var aJ=aG.getDoc().findMarksAt(aM);var aH;var aI=false;for(var aK=0;aK<aJ.length;aK++){aH=aJ[aK].editDts;switch(aH.tag){case"RELABEL":case"MOVREL":case"MOVE":aH.connectorVisible=!aH.connectorVisible;aI=true;break}}if(aI){Z(aG.dv.mv.svg);if(aG.dv.mv.hasLeft){z(aG.dv.mv.left)}if(aG.dv.mv.hasRight){z(aG.dv.mv.right)}}}function al(aX,bh,bJ){if(!aX.mv||!bh){return}var ba=aX.mv.bound;if(!ba){return}var a6=aX.type=="left";var bB=aX.mv.svg;if(bB){a(bB,"width",aX.mv.glasspane.offsetWidth,"height",aX.mv.glasspane.offsetHeight)}var bU=aX.edit.getScrollInfo().top,bK=aX.orig.getScrollInfo().top;var aK=aX.orig,a2=aK.getDoc();var bE=aX.edit,aP=bE.getDoc();var bG=aX.type+"Clip";var bv="editClip";var bC=aX.mv.defs;var be=G(ba,bC,bG,aK,a6?aX.mv.clipL:aX.mv.clipR,a6?aX.mv.rectL:aX.mv.rectR);var a4=G(ba,bC,bv,bE,aX.mv.clip,aX.mv.rect);var aL=be[2];var bT=a4[2];if(aL||bT){ab(aL,bT,be[1],a4[1],a4[3],bC,"glasspaneClip")}else{var bt=a6?aK:bE;a(aX.mv.gclip,"id","glasspaneClip");var bi=aX.mv.glasspane.getBoundingClientRect();var a8=0;var bL=bi.width;var bc=bt.display.gutters;if(bc){var bH=bc.getBoundingClientRect();a8+=bH.width+1;bL-=bH.width+1}a(aX.mv.grect,"x",a8,"y",1,"height",bi.height-2,"width",bL)}var bw=be[0];var bX=a4[0];var bx=new Array(bE,aK);var bk=new Array(aP,a2);var aO=new Array(bv,bG);var bp=new Array(2);var aT=new Array(2);var bd="";var bW="";var aI="";var aG="";var a1="";var aY=new Array([],[]);for(var bM=0;bM<bh.length;bM++){var a3=bh[bM];if(a3==null){continue}var aM=a3.tag;if(aM!="ALIGN"&&!a3.connectorVisible){continue}var aH=new Array(false,false);var a5=new Array("","");var bs=new Array(aX.edit.getViewport(),aX.orig.getViewport());var bz=0;for(var bj=0;bj<2;bj++){var bD=bj+1;var a7="start"+bD;var bY="end"+bD;var a0="line"+bD;if(a7 in a3&&bY in a3){var bF=a3[a7],aN=a3[bY];if(bF<=aN){bz=aN-bF;var bQ=bk[bj].posFromIndex(bF);var bI=bk[bj].getLine(bQ.line).charAt(bQ.ch);if(bI==""){bQ=new ao(bQ.line+1,0)}bp[bj]=bQ;var bq=aT[bj]=bk[bj].posFromIndex(aN);aH[bj]=bQ.line>bs[bj].to||bq.line<bs[bj].from}}else{if(a0 in a3){var bS=a3[a0];var aJ=bS-1;var aW=bk[bj].getLine(aJ);if(aW){for(var bb=0;bb<aW.length;bb++){if(aW.charAt(bb).match(/\S/g)){break}}var bQ=bp[bj]=new ao(aJ,bb);var bq=aT[bj]=new ao(aJ,aW.length-1);aH[bj]=bQ.line>bs[bj].to||bq.line<bs[bj].from}else{aH[bj]=true}}}}if(aH[0]&&aH[1]){continue}if(bJ){for(var bj=0;bj<2;bj++){if(a5[bj]!=""){var bf="v"+(bj+1);var a9=a3[bf]||"?";a5[bj]+="z";aY[bj].push([a5[bj],a9,bz])}}}var aU=null;switch(aM){case"DELETE":break;case"INSERT":break;case"RELABEL":case"MOVREL":case"MOVE":case"ALIGN":case"CORR":var bO=bp[0],bn=aT[0],bN=bp[1],bm=aT[1];var aV=ba.left,aS=ba.top;var aZ,bV;var aR,aQ,bR,bP,bA;if(a6){aZ=bE.charCoords(bO,"page");if(bN.line==bm.line){bV=aK.charCoords(bm,"page")}else{bV=aK.charCoords(new ao(bN.line,a2.getLine(bN.line).length-1),"page")}aR=aZ.left-aV;bR=Math.max(bV.right,bw)-aV}else{if(bO.line==bn.line){aZ=bE.charCoords(bn,"page")}else{aZ=bE.charCoords(new ao(bO.line,aP.getLine(bO.line).length-1),"page")}bV=aK.charCoords(bN,"page");aR=Math.max(aZ.right,bX)-aV;bR=bV.left-aV}aQ=aZ.top-aS;bP=bV.top-aS;bA=Math.abs(bR+aR)/2;aR=Math.floor(aR);aQ=Math.floor(aQ);bR=Math.floor(bR);bP=Math.floor(bP);bA=Math.floor(bA);aU="M "+aR+" "+aQ+" C "+bA+" "+aQ+" "+bA+" "+bP+" "+bR+" "+bP;break;default:break}if(aU!=null){switch(aM){case"MOVE":bd+=aU+" ";break;case"RELABEL":bW+=aU+" ";break;case"MOVREL":aI+=aU+" ";break;case"ALIGN":aG+=aU+" ";break;case"CORR":a1+=aU+" ";break;default:break}}}if(bJ){var by=function(b2,b0){var b1=b2[2];var bZ=b0[2];if(b1<bZ){return 1}else{if(b1>bZ){return -1}}return 0};for(var bj=0;bj<2;bj++){var a5=aY[bj];var bl=a5.length;if(bl>0){a5=a5.sort(by);for(var bg=0;bg<bl;bg++){var bo=document.createElementNS(h,"path");bB.appendChild(bo);var a9=a5[bg][1];if(aX.showToolTip){var bu=new ax(bB,bo,aX,a9);n.on(bo,"mouseover",s(bu));n.on(bo,"mouseout",az(bu));n.on(bo,"wheel",ar(aX,bx[bj]));bo.addEventListener("DOMMouseScroll",I(bu))}var br=a5[bg][0];a(bo,"d",br,"clip-path","url(#"+aO[bj]+")","pointer-events","visibleFill","class",l.frameEss)}}}}if(bd!=""){a(bB.appendChild(a6?aX.mv.connectorMovL:aX.mv.connectorMov),"d",bd,"clip-path","url(#glasspaneClip)","class",l.cmov)}if(bW!=""){a(bB.appendChild(a6?aX.mv.connectorRelL:aX.mv.connectorRel),"d",bW,"clip-path","url(#glasspaneClip)","class",l.crel)}if(aI!=""){a(bB.appendChild(a6?aX.mv.connectorMovRelL:aX.mv.connectorMovRel),"d",aI,"clip-path","url(#glasspaneClip)","class",l.cmovrel)}if(aG!=""){a(bB.appendChild(a6?aX.mv.connectorAlignL:aX.mv.connectorAlign),"d",aG,"clip-path","url(#glasspaneClip)","class",l.calign)}if(a1!=""){a(bB.appendChild(a6?aX.mv.connectorCorrL:aX.mv.connectorCorr),"d",a1,"clip-path","url(#glasspaneClip)","class",l.ccorr)}}function N(aO,aN,aS,aH,aM){var aJ=aO.type=="left";var aQ=aO.orig.heightAtLine(aN.origFrom,"local",true)-aS;if(aO.svg){var aG=aQ;var aL=aO.edit.heightAtLine(aN.editFrom,"local",true)-aH;if(aJ){var aX=aG;aG=aL;aL=aX}var aK=aO.orig.heightAtLine(aN.origTo,"local",true)-aS;var aT=aO.edit.heightAtLine(aN.editTo,"local",true)-aH;if(aJ){var aX=aK;aK=aT;aT=aX}var aR=" C "+aM/2+" "+aL+" "+aM/2+" "+aG+" "+(aM+2)+" "+aG;var aP=" C "+aM/2+" "+aK+" "+aM/2+" "+aT+" -1 "+aT;a(aO.svg.appendChild(document.createElementNS(h,"path")),"d","M -1 "+aL+aR+" L "+(aM+2)+" "+aK+aP+" z","class",aO.classes.connect)}if(aO.copyButtons){var aV=aO.copyButtons.appendChild(ad("div",aO.type=="left"?"\u21dd":"\u21dc","CodeMirror-merge-copy"));var aU=aO.mv.options.allowEditingOriginals;aV.title=aO.edit.phrase(aU?"Push to left":"Revert chunk");aV.chunk=aN;aV.style.top=(aN.origTo>aN.origFrom?aQ:aO.edit.heightAtLine(aN.editFrom,"local")-aH)+"px";if(aU){var aW=aO.orig.heightAtLine(aN.editFrom,"local")-aH;var aI=aO.copyButtons.appendChild(ad("div",aO.type=="right"?"\u21dd":"\u21dc","CodeMirror-merge-copy-reverse"));aI.title="Push to right";aI.chunk={editFrom:aN.origFrom,editTo:aN.origTo,origFrom:aN.editFrom,origTo:aN.editTo};aI.style.top=aW+"px";aO.type=="right"?aI.style.left="2px":aI.style.right="2px"}}}function t(aK,aI){var aN=aK.edit.getDoc();var aM=aK.orig.getDoc();var aL;var aH=aI.edits1==undefined;var aG=aI.edits2==undefined;if(aH){aI.edits1=[]}if(aG){aI.edits2=[]}for(var aJ=0;aJ<aI.length;aJ++){aL=aI[aJ];if(aL==null){continue}switch(aL.tag){case"DELETE":if(aL.line1==undefined){aL.line1=aN.posFromIndex(aL.start1).line;aL.line1_=aN.posFromIndex(aL.end1).line}if(aH){aI.edits1.push(aL)}break;case"INSERT":if(aL.line2==undefined){aL.line2=aM.posFromIndex(aL.start2).line;aL.line2_=aM.posFromIndex(aL.end2).line}if(aG){aI.edits2.push(aL)}break;case"RELABEL":case"MOVE":case"MOVREL":if(aL.line1==undefined){aL.line1=aN.posFromIndex(aL.start1).line;aL.line1_=aN.posFromIndex(aL.end1).line}if(aL.line2==undefined){aL.line2=aM.posFromIndex(aL.start2).line;aL.line2_=aM.posFromIndex(aL.end2).line}if(aH){aI.edits1.push(aL)}if(aG){aI.edits2.push(aL)}break;default:break}}}function D(aG){aG.edits1.sort(function(aH,aI){if(aH!=null&&aI!=null){if(aH.line1!==undefined&&aI.line1!==undefined){return aH.line1-aI.line1}return 0}return 0});aG.edits2.sort(function(aH,aI){if(aH!=null&&aI!=null){if(aH.line2!==undefined&&aI.line2!==undefined){return aH.line2-aI.line2}return 0}return 0})}function m(aG,aL,aM,aK){if(aG.diffOutOfDate){return}var aN=aK.origTo>aM.lastLine()?ao(aK.origFrom-1):ao(aK.origFrom,0);var aJ=ao(aK.origTo,0);var aH=aK.editTo>aL.lastLine()?ao(aK.editFrom-1):ao(aK.editFrom,0);var aI=ao(aK.editTo,0);var aO=aG.mv.options.revertChunk;if(aO){aO(aG.mv,aM,aN,aJ,aL,aH,aI)}else{aL.replaceRange(aM.getRange(aN,aJ),aH,aI)}}var ap=n.MergeView=function(aZ,aL){if(!(this instanceof ap)){return new ap(aZ,aL)}console.log("[diffviewer.MergeView] constructing...");var a1=aL.essentialsLeft;var a0=aL.essentials;var aR=aL.essentialsMapped;if(a1!=undefined&&a0!=undefined&&aR!=undefined){this.diffDtsEss=Y(a1,a0,aR)}var aY=this.svg=document.createElementNS(h,"svg");var a8=this.glasspane=ad("div",[aY],"CodeMirror-glasspane");this.connectorMov=document.createElementNS(h,"path");this.connectorRel=document.createElementNS(h,"path");this.connectorMovRel=document.createElementNS(h,"path");this.connectorAlign=document.createElementNS(h,"path");this.connectorCorr=document.createElementNS(h,"path");this.rects=new Array(document.createElementNS(h,"path"),document.createElementNS(h,"path"));this.defs=aY.appendChild(document.createElementNS(h,"defs"));this.gclip=this.defs.appendChild(document.createElementNS(h,"clipPath"));this.grect=this.gclip.appendChild(document.createElementNS(h,"rect"));this.clip=this.defs.appendChild(document.createElementNS(h,"clipPath"));this.rect=this.clip.appendChild(document.createElementNS(h,"rect"));this.clipR=this.defs.appendChild(document.createElementNS(h,"clipPath"));this.rectR=this.clipR.appendChild(document.createElementNS(h,"rect"));this.options=aL;var a7=aL.origLeft;var a2=aL.origRight==null?aL.orig:aL.origRight;var aH=aL.diffLeft;var aV=aL.diffRight==null?aL.diff:aL.diffRight;var aG=this.hasLeft=a7!=null;var aS=this.hasRight=a2!=null;var aP=this.panes=1+(aG?1:0)+(aS?1:0);var aT=[],aM=this.left=null,a5=this.right=null;var aX=this;aT.push(a8);if(aG){this.connectorMovL=document.createElementNS(h,"path");this.connectorRelL=document.createElementNS(h,"path");this.connectorMovRelL=document.createElementNS(h,"path");this.connectorAlignL=document.createElementNS(h,"path");this.connectorCorrL=document.createElementNS(h,"path");this.connectorAlignL=document.createElementNS(h,"path");this.clipL=this.defs.appendChild(document.createElementNS(h,"clipPath"));this.rectL=this.clipL.appendChild(document.createElementNS(h,"rect"));aM=this.left=new ac(this,"left",2);var a4=ad("div",null,"CodeMirror-merge-pane CodeMirror-merge-left");aT.push(a4);aT.push(av(aM))}var aO=ad("div",null,"CodeMirror-merge-pane CodeMirror-merge-editor");aT.push(aO);if(aS){a5=this.right=new ac(this,"right",1);aT.push(av(a5));var aN=ad("div",null,"CodeMirror-merge-pane CodeMirror-merge-right");aT.push(aN)}(aS?aN:aO).className+=" CodeMirror-merge-pane-rightmost";aT.push(ad("div",null,null,"height: 0; clear: both;"));var a3=this.wrap=aZ.appendChild(ad("div",aT,"CodeMirror-merge CodeMirror-merge-"+aP+"pane"));var aU=ai(aL);aU.readOnly=true;this.edit=n(aO,aU);this.edit.on("mousedown",d);if(aM){aM.init(a4,a7,aH,aL)}if(a5){a5.init(aN,a2,aV,aL)}if(aM){this.bound=a4.getBoundingClientRect()}else{this.bound=aO.getBoundingClientRect()}if(aM&&aL.lineLeft>0){aM.orig.scrollTo(0,aM.orig.heightAtLine(aL.lineLeft-1,"local"))}if(a5&&aL.lineRight>0){a5.orig.scrollTo(0,a5.orig.heightAtLine(aL.lineRight-1,"local"))}if(aL.line>0){this.edit.scrollTo(0,this.edit.heightAtLine(aL.line-1,"local"))}if(aL.collapseIdentical){this.editor().operation(function(){x(aX,aL.collapseIdentical)})}if(aL.connect=="align"){this.aligners=[];V(this.left||this.right,true)}if(aG){t(aM,aH);D(aH)}if(aS){t(a5,aV);D(aV)}if(aM){aM.registerEvents(a5)}if(a5){a5.registerEvents(aM)}var aK=function(){aX.resetHeight();if(aM){z(aM)}if(a5){z(a5)}aX.annotate()};n.on(window,"resize",aK);var a6=setInterval(function(){for(var a9=a3.parentNode;a9&&a9!=document.body;a9=a9.parentNode){}if(!a9){clearInterval(a6);n.off(window,"resize",aK)}},5000);this.legend=document.getElementById("legend");var aQ=document.createElement("span");var aW=document.createElement("span");var aI=document.createElement("span");var aJ=document.createElement("span");aQ.innerHTML="deleted";a(aQ,"class",l.del);aW.innerHTML="inserted";a(aW,"class",l.ins);aI.innerHTML="relabeled";a(aI,"class",l.rel);aJ.innerHTML="moved";a(aJ,"class",l.mov);this.legend.appendChild(aQ);this.legend.appendChild(document.createTextNode(" "));this.legend.appendChild(aW);this.legend.appendChild(document.createTextNode(" "));this.legend.appendChild(aI);this.legend.appendChild(document.createTextNode(" "));this.legend.appendChild(aJ);console.log("[diffviewer.MergeView] done.")};function av(aJ){var aI=aJ.lockButton=ad("div",null,"CodeMirror-merge-scrolllock");var aK=ad("div",[aI],"CodeMirror-merge-scrolllock-wrap");n.on(aI,"click",function(){S(aJ,!aJ.lockScroll)});var aH=[aK];if(aJ.mv.options.revertButtons!==false){aJ.copyButtons=ad("div",null,"CodeMirror-merge-copybuttons-"+aJ.type);n.on(aJ.copyButtons,"click",function(aM){var aL=aM.target||aM.srcElement;if(!aL.chunk){return}if(aL.className=="CodeMirror-merge-copy-reverse"){m(aJ,aJ.orig,aJ.edit,aL.chunk);return}m(aJ,aJ.edit,aJ.orig,aL.chunk)});aH.unshift(aJ.copyButtons)}if(aJ.mv.options.connect!="align"){var aG=document.createElementNS&&document.createElementNS(h,"svg");if(aG&&!aG.createSVGRect){aG=null}aJ.svg=aG;if(aG){aH.push(aG)}}return aJ.gap=ad("div",aH,"CodeMirror-merge-gap")}ap.prototype={constuctor:ap,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(aG){if(this.right){this.right.setShowDifferences(aG)}if(this.left){this.left.setShowDifferences(aG)}},rightChunks:function(){if(this.right){aq(this.right);return this.right.chunks}},leftChunks:function(){if(this.left){aq(this.left);return this.left.chunks}},setShowDts:function(aG){if(this.right){this.right.setShowDts(aG)}if(this.left){this.left.setShowDts(aG)}if(aG==3&&this.left&&this.right){Z(this.svg);if(this.hasRight){z(this.right)}if(this.hasLeft){z(this.left)}}this.annotate();if(aG){this.legend.style.visibility="visible"}else{this.legend.style.visibility="hidden"}},init:function(){this.resetHeight();this.annotate()},annotate:function(){if(this.left){var aH=this.left;if((aH.showDts&aH.index)>0){if(!aH.dtsAnnot){aH.dtsAnnot=new P(aH.edit,aH.orig,aH.diffDts)}else{try{aH.dtsAnnot.clear()}catch(aG){aH.dtsAnnot=new P(aH.edit,aH.orig,aH.diffDts)}}aH.dtsAnnot.mark()}else{if(this.diffDtsEss!=[]){if(!aH.dtsAnnotEss){aH.dtsAnnotEss=new P(aH.edit,aH.orig,this.diffDtsEss)}else{try{aH.dtsAnnotEss.clear()}catch(aG){aH.dtsAnnotEss=new P(aH.edit,aH.orig,this.diffDtsEss)}}aH.dtsAnnotEss.mark()}}}if(this.right){var aH=this.right;if((aH.showDts&aH.index)>0){if(!aH.dtsAnnot){aH.dtsAnnot=new P(aH.edit,aH.orig,aH.diffDts)}else{try{aH.dtsAnnot.clear()}catch(aG){aH.dtsAnnot=new P(aH.edit,aH.orig,aH.diffDts)}}aH.dtsAnnot.mark()}}},resetHeight:function(){var aG=$(window).height();var aJ=document.getElementById("head");var aI=document.getElementById("tail");var aK=(aG-aJ.offsetHeight-aI.offsetHeight)+"px";var aL=document.getElementsByClassName("CodeMirror-merge");for(i=0;i<aL.length;i++){aL[i].style.height=aK}var aH=document.getElementsByClassName("CodeMirror");for(i=0;i<aH.length;i++){aH[i].style.height=aK}}};function o(aG){if(typeof aG=="string"){return aG}else{return aG.getValue()}}var U;function aB(aH,aG,aK){if(!U){U=new diff_match_patch()}var aL=U.diff_main(aH,aG);for(var aJ=0;aJ<aL.length;++aJ){var aI=aL[aJ];if(aK?!/[^ \t]/.test(aI[1]):!aI[1]){aL.splice(aJ--,1)}else{if(aJ&&aL[aJ-1][0]==aI[0]){aL.splice(aJ--,1);aL[aJ][1]+=aI[1]}}}return aL}function aC(aN,aL){for(var aJ=0;aJ<aN.length;++aJ){var aI=aN[aJ];if(aI!=null){var aM=aI.tag;if(aM=="ALIGN"){var aH=aI.line1;var aG=aI.line2;var aK=aI.ext;aL(aH,aH+aK-1,aG,aG+aK-1)}}}}function r(aT){var aL=[];if(!aT.length){return aL}var aQ=0,aP=0;var aU=ao(0,0),aS=ao(0,0);for(var aI=0;aI<aT.length;++aI){var aH=aT[aI],aR=aH[0];if(aR==DIFF_EQUAL){var aG=!F(aT,aI)||aU.line<aQ||aS.line<aP?1:0;var aK=aU.line+aG,aJ=aS.line+aG;an(aU,aH[1],null,aS);var aM=q(aT,aI)?1:0;var aO=aU.line+aM,aN=aS.line+aM;if(aO>aK){if(aI){aL.push({origFrom:aP,origTo:aJ,editFrom:aQ,editTo:aK})}aQ=aO;aP=aN}}else{an(aR==DIFF_INSERT?aU:aS,aH[1])}}if(aQ<=aU.line||aP<=aS.line){aL.push({origFrom:aP,origTo:aS.line+1,editFrom:aQ,editTo:aU.line+1})}return aL}function q(aI,aG){if(aG==aI.length-1){return true}var aH=aI[aG+1][1];if((aH.length==1&&aG<aI.length-2)||aH.charCodeAt(0)!=10){return false}if(aG==aI.length-2){return true}aH=aI[aG+2][1];return(aH.length>1||aG==aI.length-3)&&aH.charCodeAt(0)==10}function F(aI,aG){if(aG==0){return true}var aH=aI[aG-1][1];if(aH.charCodeAt(aH.length-1)!=10){return false}if(aG==1){return true}aH=aI[aG-2][1];return aH.charCodeAt(aH.length-1)==10}function k(aK,aG,aM){var aO,aQ,aI,aL;for(var aH=0;aH<aK.length;aH++){var aN=aK[aH];var aP=aM?aN.editFrom:aN.origFrom;var aJ=aM?aN.editTo:aN.origTo;if(aQ==null){if(aP>aG){aQ=aN.editFrom;aL=aN.origFrom}else{if(aJ>aG){aQ=aN.editTo;aL=aN.origTo}}}if(aJ<=aG){aO=aN.editTo;aI=aN.origTo}else{if(aP<=aG){aO=aN.editFrom;aI=aN.origFrom}}}return{edit:{before:aO,after:aQ},orig:{before:aI,after:aL}}}function T(aM,aL,aI){var aH,aG,aK,aJ;aC(aM,function(aN,aS,aQ,aO){var aP=aI?aQ:aN;var aR=aI?aO:aS;if(aG==null){if(aP>aL){aG=aQ;aJ=aN}else{if(aR>aL){aG=aO;aJ=aS}}}if(aR<=aL){aH=aO;aK=aS}else{if(aP<=aL){aH=aQ;aK=aN}}});return{edit:{before:aH,after:aG},orig:{before:aK,after:aJ}}}function f(aH,aL,aK){aH.addLineClass(aL,"wrap","CodeMirror-merge-collapsed-line");var aI=document.createElement("span");aI.className="CodeMirror-merge-collapsed-widget";aI.title=aH.phrase("Identical text collapsed. Click to expand.");var aJ=aH.markText(ao(aL,0),ao(aK-1),{inclusiveLeft:true,inclusiveRight:true,replacedWith:aI,clearOnEnter:true});function aG(){aJ.clear();aH.removeLineClass(aL,"wrap","CodeMirror-merge-collapsed-line")}if(aJ.explicitlyCleared){aG()}n.on(aI,"click",aG);aJ.on("clear",aG);n.on(aI,"click",aG);return{mark:aJ,clear:aG}}function u(aI,aL){var aK=[];function aG(){for(var aN=0;aN<aK.length;aN++){aK[aN].clear()}}for(var aH=0;aH<aL.length;aH++){var aJ=aL[aH];var aM=f(aJ.cm,aJ.line,aJ.line+aI);aK.push(aM);aM.mark.on("clear",aG)}return aK[0].mark}function au(aK,aL,aM,aG){for(var aJ=0;aJ<aK.chunks.length;aJ++){var aI=aK.chunks[aJ];for(var aH=aI.editFrom-aL;aH<aI.editTo+aL;aH++){var aN=aH+aM;if(aN>=0&&aN<aG.length){aG[aN]=false}}}}function x(aP,aJ){if(typeof aJ!="number"){aJ=2}var aL=[],aO=aP.editor(),aG=aO.firstLine();for(var aH=aG,aM=aO.lastLine();aH<=aM;aH++){aL.push(true)}if(aP.left){au(aP.left,aJ,aG,aL)}if(aP.right){au(aP.right,aJ,aG,aL)}for(var aK=0;aK<aL.length;aK++){if(aL[aK]){var aR=aK+aG;for(var aQ=1;aK<aL.length-1&&aL[aK+1];aK++,aQ++){}if(aQ>aJ){var aN=[{line:aR,cm:aO}];if(aP.left){aN.push({line:L(aR,aP.left.chunks),cm:aP.left.orig})}if(aP.right){aN.push({line:L(aR,aP.right.chunks),cm:aP.right.orig})}var aI=u(aQ,aN);if(aP.options.onCollapse){aP.options.onCollapse(aP,aR,aQ,aI)}}}}}function ad(aG,aK,aJ,aI){var aL=document.createElement(aG);if(aJ){aL.className=aJ}if(aI){aL.style.cssText=aI}if(typeof aK=="string"){aL.appendChild(document.createTextNode(aK))}else{if(aK){for(var aH=0;aH<aK.length;++aH){aL.appendChild(aK[aH])}}}return aL}function Z(aH){for(var aG=aH.childNodes.length;aG>0;--aG){aH.removeChild(aH.firstChild)}}function a(aG){for(var aH=1;aH<arguments.length;aH+=2){aG.setAttribute(arguments[aH],arguments[aH+1])}}function ai(aH,aG){if(!aG){aG={}}for(var aI in aH){if(aH.hasOwnProperty(aI)){aG[aI]=aH[aI]}}return aG}function an(aM,aK,aL,aH){var aJ=aL?ao(aM.line,aM.ch):aM,aG=0;for(;;){var aI=aK.indexOf("\n",aG);if(aI==-1){break}++aJ.line;if(aH){++aH.line}aG=aI+1}aJ.ch=(aG?0:aJ.ch)+(aK.length-aG);if(aH){aH.ch=(aG?0:aH.ch)+(aK.length-aG)}return aJ}var H=1,Q=2,X=4;function b(aG){this.cm=aG;this.alignable=[];this.height=aG.doc.height;var aH=this;aG.on("markerAdded",function(aJ,aI){if(!aI.collapsed){return}var aK=aI.find(1);if(aK!=null){aH.set(aK.line,X)}});aG.on("markerCleared",function(aK,aJ,aL,aI){if(aI!=null&&aJ.collapsed){aH.check(aI,X,aH.hasMarker)}});aG.on("markerChanged",this.signal.bind(this));aG.on("lineWidgetAdded",function(aI,aJ,aK){if(aJ.mergeSpacer){return}if(aJ.above){aH.set(aK-1,Q)}else{aH.set(aK,H)}});aG.on("lineWidgetCleared",function(aI,aJ,aK){if(aJ.mergeSpacer){return}if(aJ.above){aH.check(aK-1,Q,aH.hasWidgetBelow)}else{aH.check(aK,H,aH.hasWidget)}});aG.on("lineWidgetChanged",this.signal.bind(this));aG.on("change",function(aJ,aN){var aM=aN.from.line,aL=aN.to.line-aN.from.line;var aK=aN.text.length-1,aI=aM+aK;if(aL||aK){aH.map(aM,aL,aK)}aH.check(aI,X,aH.hasMarker);if(aL||aK){aH.check(aN.from.line,X,aH.hasMarker)}});aG.on("viewportChange",function(){if(aH.cm.doc.height!=aH.height){aH.signal()}})}b.prototype={signal:function(){n.signal(this,"realign");this.height=this.cm.doc.height},set:function(aJ,aG){var aI=-1;for(;aI<this.alignable.length;aI+=2){var aH=this.alignable[aI]-aJ;if(aH==0){if((this.alignable[aI+1]&aG)==aG){return}this.alignable[aI+1]|=aG;this.signal();return}if(aH>0){break}}this.signal();this.alignable.splice(aI,0,aJ,aG)},find:function(aH){for(var aG=0;aG<this.alignable.length;aG+=2){if(this.alignable[aG]==aH){return aG}}return -1},check:function(aK,aH,aI){var aJ=this.find(aK);if(aJ==-1||!(this.alignable[aJ+1]&aH)){return}if(!aI.call(this,aK)){this.signal();var aG=this.alignable[aJ+1]&~aH;if(aG){this.alignable[aJ+1]=aG}else{this.alignable.splice(aJ,2)}}},hasMarker:function(aI){var aH=this.cm.getLineHandle(aI);if(aH.markedSpans){for(var aG=0;aG<aH.markedSpans.length;aG++){if(aH.markedSpans[aG].marker.collapsed&&aH.markedSpans[aG].to!=null){return true}}}return false},hasWidget:function(aI){var aH=this.cm.getLineHandle(aI);if(aH.widgets){for(var aG=0;aG<aH.widgets.length;aG++){if(!aH.widgets[aG].above&&!aH.widgets[aG].mergeSpacer){return true}}}return false},hasWidgetBelow:function(aI){if(aI==this.cm.lastLine()){return false}var aH=this.cm.getLineHandle(aI+1);if(aH.widgets){for(var aG=0;aG<aH.widgets.length;aG++){if(aH.widgets[aG].above&&!aH.widgets[aG].mergeSpacer){return true}}}return false},map:function(aN,aL,aM){var aP=aM-aL,aO=aN+aL,aJ=-1,aG=-1;for(var aK=0;aK<this.alignable.length;aK+=2){var aI=this.alignable[aK];if(aI==aN&&(this.alignable[aK+1]&Q)){aJ=aK}if(aI==aO&&(this.alignable[aK+1]&Q)){aG=aK}if(aI<=aN){continue}else{if(aI<aO){this.alignable.splice(aK--,2)}else{this.alignable[aK]+=aP}}}if(aJ>-1){var aH=this.alignable[aJ+1];if(aH==Q){this.alignable.splice(aJ,2)}else{this.alignable[aJ+1]=aH&~Q}}if(aG>-1&&aM){this.set(aN+aM,Q)}}};function O(aH,aG){return(aH.line-aG.line||aH.ch-aG.ch)<0?aH:aG}function aj(aH,aG){return(aH.line-aG.line||aH.ch-aG.ch)>0?aH:aG}function C(aH,aG){return aH.line==aG.line&&aH.ch==aG.ch}function ak(aL,aK,aG){for(var aI=aL.length-1;aI>=0;aI--){var aH=aL[aI];var aJ=(aG?aH.origTo:aH.editTo)-1;if(aJ<aK){return aJ}}}function R(aL,aK,aG){for(var aI=0;aI<aL.length;aI++){var aH=aL[aI];var aJ=(aG?aH.origFrom:aH.editFrom);if(aJ>aK){return aJ}}}function am(aL,aH){var aN=null,aM=aL.state.diffViews,aO=aL.getCursor().line;if(aM){for(var aJ=0;aJ<aM.length;aJ++){var aG=aM[aJ],aI=aL==aG.orig;aq(aG);var aK=aH<0?ak(aG.chunks,aO,aI):R(aG.chunks,aO,aI);if(aK!=null&&(aN==null||(aH<0?aK>aN:aK<aN))){aN=aK}}}if(aN!=null){aL.setCursor(aN,0)}else{return n.Pass}}n.commands.goNextDiff=function(aG){return am(aG,1)};n.commands.goPrevDiff=function(aG){return am(aG,-1)}});